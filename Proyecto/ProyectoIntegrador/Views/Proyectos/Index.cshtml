@model IEnumerable<ProyectoIntegrador.BaseDatos.Proyecto>
@using Microsoft.AspNet.Identity
@{
    ViewBag.Title = "Consulta";

}

@*Se crean variables con el fin de identificar las clases, para poder activar un tab dependiendo del id*@
@{ var idCarta = "#a"; }
@{ var idTab = "a"; }


    <head>
        <script src="https://code.jquery.com/jquery-2.2.4.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    </head>


    <body>

        @if (Request.IsAuthenticated)
        {


            <h2>Consulta</h2>

            //Revisa si tiene permisos para agregar proyectos
            if (ViewBag.permisosEspecificos.Item5 == 1)
            {
                <p>
                    @Html.ActionLink("AgregarUsuario", "Agregar")
                </p>

                <p>
                    @Html.ActionLink("Create New", "Create")
                </p>
            }

            <div class="container " style="max-width: 1800px">
                <div class="row">

                    <div class="col-6 col-md-4 h-25">

                        @*NavBar con el titulo y el input para realizar busquedas*@
                        <nav class="navbar navbar-light bg-light justify-content-between">
                            <a class="navbar-brand">ListaProyectos</a>
                            <form class="form-inline">
                                <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
                                <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
                            </form>
                        </nav>



                        <div class="list-group h-100 overflow-auto" style="max-height: 650px" id="list-tab" role="tablist">



                            @foreach (var item in Model)
                            {
                                <a class="list-group-item list-group-item-action overflow-auto " id="list-home-list" data-toggle="list" href=@idCarta role="tab">@Html.DisplayFor(modelItem => item.nombre)</a>
                                { idCarta += 1; }
                            }


                        </div>
                    </div>


                    <div class="col-12 col-md-8">
                        <div class="tab-content w-75 h-25" id="nav-tabContent">


                            @foreach (var item in Model)
                            {

                                <div class="tab-pane fade " id=@idTab role="tabpanel" aria-labelledby="list-home-list">



                                    <div class="card" style="border-radius: 30px ; background-color:#C09F80">
                                        <div class="card-body">
                                            <p>
                                                @Html.DisplayFor(modelItem => item.nombre)
                                            </p>

                                            <p>
                                                @Html.DisplayFor(modelItem => item.objetivo)
                                            </p>

                                            <p>
                                                @Html.DisplayFor(modelItem => item.estado)
                                            </p>

                                            @if (ViewBag.permisosEspecificos.Item4 == 1 || ViewBag.permisosEspecificos.Item4 == 2)
                                            {

                                                @Html.ActionLink("Edit", "Edit", new { id = item.idProyectoAID }, htmlAttributes: new { @class = "btn btn-primary", @role = "button" })
                                            }


                                            @if (ViewBag.permisosEspecificos.Item6 == 1 || ViewBag.permisosEspecificos.Item6 == 2)
                                            {


                                                <!-- Button trigger modal -->
                                                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal" data-whatever="@item.idProyectoAID">
                                                    Eliminar
                                                </button>



                                            }





                                        </div>
                                    </div>
                                </div>
                                //Le agrega un digito mas al idTab
                                { idTab += 1; }
                            }



                        </div>
                    </div>
                </div>
            </div>


            <!-- Modal -->
            <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Esta seguro que quiere eliminar el Proyecto</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="container">
                            <div class="row">
                                <div class="col">
                                    <button type="button" class="btn btn-primary" data-dismiss="modal">Cancelar</button>
                                </div>
                                <div class="col">
                                    <a id="pager" href="/Proyectos/Eliminar/" class="btn btn-primary" role="button" aria-pressed="true">Acceptar</a>
                                </div>
                                
                              
                            </div>
                            </div>


                                       
                          
                        </div>
                    </div>
                </div>
            </div>

        }
        else
        {
            <div class="alert alert-primary text-center" style="color:white ; background-color:red"> Necesita hacer login para poder ver los proyectos</div>
        }


        <script>
            $('#exampleModal').on('show.bs.modal', function (event) {
                var button = $(event.relatedTarget) // Button that triggered the modal
                var recipient = button.data('whatever') // Extract info from data-* attributes
                // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
                // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
                var modal = $(this)


                var a = document.getElementById('pager')
                a.href += recipient;
      
            })
        </script>


    </body>









